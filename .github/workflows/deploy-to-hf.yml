name: Deploy to Hugging Face

on:
  push:
    branches:
      - main  # Trigger on push to main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Fetch all history for proper git operations

      - name: Set up Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Replace README with HF version
        run: |
          cp README_HF.md README.md
          git add README.md

      - name: Remove images from git history
        run: |
          git filter-branch -f --index-filter 'git rm -r --cached --ignore-unmatch images/' --prune-empty -- --all

      - name: Push to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: Rachel0619
          HF_SPACE_NAME: PickLLM
        run: |
          git remote add hf https://${HF_USERNAME}:${HF_TOKEN}@huggingface.co/spaces/${HF_USERNAME}/${HF_SPACE_NAME} || true
          git push hf main --force
